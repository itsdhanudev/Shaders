{"code":"#version 320 es\nprecision highp float;\n\nlayout(triangles) in;\nlayout(triangle_strip, max_vertices \u003d 12) out;\n\nin vec3 o_pos[];\nin vec3 o_normal[];\n\nout float f_height;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n// Grass shape\nuniform float u_grassHeight;\nuniform float u_grassWidth;\n\n// Wind\nuniform float u_time;\nuniform float u_windStrength;\nuniform float u_windSpeed;\n\n// Interaction\nuniform vec3  u_interactorPos;\nuniform float u_interactRadius;\nuniform float u_interactStrength;\n\nfloat hash(vec3 p) {\n    return fract(sin(dot(p, vec3(12.9898,78.233,45.164))) * 43758.5453);\n}\n\nfloat bladeCurve(float t) {\n    return t * t;\n}\n\nvoid emitBlade(vec3 basePos, vec3 normal) {\n\n    float h \u003d u_grassHeight * (0.6 + hash(basePos));\n    float w \u003d u_grassWidth;\n\n    vec3 wind \u003d\n        vec3(\n            sin(u_time * u_windSpeed + basePos.x),\n            0.0,\n            cos(u_time * u_windSpeed + basePos.z)\n        ) * u_windStrength;\n\n    vec3 delta \u003d basePos - u_interactorPos;\n    float dist \u003d length(delta);\n\n    float influence \u003d 1.0 - clamp(dist / u_interactRadius, 0.0, 1.0);\n    influence \u003d smoothstep(0.0, 1.0, influence);\n\n    vec3 pushDir \u003d (dist \u003e 0.0001) ? normalize(delta) : vec3(0.0);\n\n    vec3 bend \u003d pushDir * influence * u_interactStrength;\n\n    vec3 tip \u003d\n        basePos +\n        normal * h +\n        wind +\n        bend;\n\n    vec3 right \u003d normalize(cross(normal, vec3(0,1,0))) * w;\n\n    f_height \u003d 0.0;\n    gl_Position \u003d projectionMatrix * viewMatrix * vec4(basePos - right, 1.0);\n    EmitVertex();\n\n    f_height \u003d 0.0;\n    gl_Position \u003d projectionMatrix * viewMatrix * vec4(basePos + right, 1.0);\n    EmitVertex();\n\n    f_height \u003d 1.0;\n    gl_Position \u003d projectionMatrix * viewMatrix * vec4(tip, 1.0);\n    EmitVertex();\n\n    EndPrimitive();\n}\n\nvoid main() {\n    for (int i \u003d 0; i \u003c 3; i++) {\n        emitBlade(o_pos[i], o_normal[i]);\n    }\n}\n"}